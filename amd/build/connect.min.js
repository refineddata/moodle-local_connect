define(["jquery","jqueryui"],function(a,b){return{init:function(){function b(b){a("input[name='typeisvideo']").val()||(a("#id_ajax_spin").remove(),a("#id_generate").after(' <span id="id_ajax_spin" class="rt-loading-image"></span>'),a.post(window.wwwroot+"/mod/connectmeeting/ajax/ajax.php",{action:"connect_get_sco_by_url",url:b},function(c){if(a("#id_telephony").show(),a("#id_template").show(),c.refined_noauth)a("#id_url").val(""),a("#id_name").val(""),d("danger",c.refined_noauth_message);else if(c.error)d("danger",c.error);else if("connect_not_update"==c.response){if("undefined"!=typeof M.str.connectmeeting.eeting.connect_not_update){var e=M.str.connectmeeting.typelistmeeting+M.str.connectmeeting.connect_not_update;d("danger",e)}}else if("no-data"==c.response||c.response.fixedurl){if(c.response.fixedurl&&(b=c.response.fixedurl),a("#id_url").val(b),"undefined"!=typeof M.str.connectmeeting.whensaved){var e=M.str.connectmeeting.notfound+M.str.connectmeeting.typelistmeeting+M.str.connectmeeting.whensaved;d("success",e)}else if("undefined"!=typeof M.str.connectmeeting.connect_not_update){var e=M.str.connectmeeting.notfound+M.str.connectmeeting.typelistmeeting+M.str.connectmeeting.connect_not_update;d("danger",e)}a("#id_name").removeClass("do-not-check")}else if(c.response.name){a("#id_url").val(c.response.url.replace(/\//g,"")),a("#id_name").val(c.response.name).addClass("do-not-check"),"undefined"!=typeof tinymce?tinymce.get("id_introeditor").setContent(c.response.desc):a("#id_introeditoreditable").html(c.response.desc);var f=new Date(1e3*c.response.start);a("#id_start_day").val(f.getDate()),a("#id_start_month").val(f.getMonth()+1),a("#id_start_year").val(f.getFullYear()),a("#id_start_hour").val(f.getHours()),a("#id_start_minute").val(f.getMinutes()),a("#id_duration").val(c.response.end-c.response.start),a("#id_telephony").hide(),a("#id_template").hide()}else"denied"==c.response?(a("#id_url").val(""),d("danger","Access Denied, you do not have access to this url")):"folderdenied"==c.response?(a("#id_url").val(""),d("danger","Access Denied, you do not have access to create a meeting in the default folder")):d("danger",c)}).done(function(){a("#id_ajax_spin").remove()}))}function c(b){a("input[name='typeisvideo']").val()||(a("#id_ajax_spin_name").remove(),a("#id_name").after(' <span id="id_ajax_spin_name" class="rt-loading-image"></span>'),a.post(window.wwwroot+"/mod/connectmeeting/ajax/ajax.php",{action:"connect_get_sco_by_name",name:b},function(c){if(c.refined_noauth)a("#id_url").val(""),a("#id_name").val("");else if(c.error)e("danger",c.error);else if("no-data"==c.response){var d="The requested name is not found and can be used";e("success",d)}else{var d="The requested name ( "+b+" ) is found and can not be used";e("danger",d),a("#id_name").val("")}}).done(function(){a("#id_ajax_spin_name").remove()}))}function d(b,c){a("#fgroup_id_urlgrp_alert").remove();var d='<div class="fitem" id="fgroup_id_urlgrp_alert">';d+='<div class="felement fstatic alert alert-'+b+' alert-dismissible">',d+='<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>',d+=c,d+="</div>",d+="</div>",a("#id_url").parent().parent().parent().parent().after(d),window.setTimeout(function(){a("#fgroup_id_urlgrp_alert").fadeTo(500,0).slideUp(500,function(){a(this).remove()})},5e3)}function e(b,c){a("#name_alert").remove();var d='<div class="fitem" id="name_alert">';d+='<div class="felement fstatic alert alert-'+b+' alert-dismissible">',d+='<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>',d+=c,d+="</div>",d+="</div>",a("#id_name").after(d),window.setTimeout(function(){a("#name_alert").fadeTo(500,0).slideUp(500,function(){a(this).remove()})},5e3)}function f(){var b=a("#id_detailgrading").val();0==b?(a("#id_threshold_1").parent().parent().parent().parent().hide(),a("#id_threshold_2").parent().parent().parent().parent().hide(),a("#id_threshold_3").parent().parent().parent().parent().hide(),a("#id_vpthreshold_1").parent().parent().parent().parent().hide(),a("#id_vpthreshold_2").parent().parent().parent().parent().hide(),a("#id_vpthreshold_3").parent().parent().parent().parent().hide()):1==b?(a("#id_threshold_1").parent().parent().parent().parent().show(),a("#id_threshold_2").parent().parent().parent().parent().show(),a("#id_threshold_3").parent().parent().parent().parent().show(),a("#id_vpthreshold_1").parent().parent().parent().parent().hide(),a("#id_vpthreshold_2").parent().parent().parent().parent().hide(),a("#id_vpthreshold_3").parent().parent().parent().parent().hide()):3==b&&(a("#id_threshold_1").parent().parent().parent().parent().hide(),a("#id_threshold_2").parent().parent().parent().parent().hide(),a("#id_threshold_3").parent().parent().parent().parent().hide(),a("#id_vpthreshold_1").parent().parent().parent().parent().show(),a("#id_vpthreshold_2").parent().parent().parent().parent().show(),a("#id_vpthreshold_3").parent().parent().parent().parent().show())}function g(a,b,c){var d='<div class="fitem" id="fgroup_id_urlgrp_alert">';d+='<div class="felement fstatic alert alert-'+b+' alert-dismissible">',d+='<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>',d+=c,d+="</div>",d+="</div>",a.html(d)}function h(){a(".connectmeeting_display_block").each(function(b){var c=a(this),d=c.data("acurl"),e=c.data("sco"),f=c.data("courseid");c.removeClass("connectmeeting_display_block").addClass("connect_display_block_done"),a.ajax({url:window.wwwroot+"/mod/connectmeeting/ajax/connectmeeting_callback.php",dataType:"html",data:{acurl:d,sco:e,courseid:f,options:encodeURIComponent(c.data("options")),frommymeetings:c.data("frommymeetings"),frommyrecordings:c.data("frommyrecordings")}}).done(function(a){c.html(a)}).fail(function(a,b,d){g(c,"danger",a.status+" "+a.statusText)})})}function i(a,b,c){var d='<div class="fitem" id="fgroup_id_urlgrp_alert">';d+='<div class="felement fstatic alert alert-'+b+' alert-dismissible">',d+='<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>',d+=c,d+="</div>",d+="</div>",a.html(d)}function j(){a(".connectquiz_display_block").each(function(b){var c=a(this),d=c.data("acurl"),e=c.data("sco"),f=c.data("courseid");c.removeClass("connectquiz_display_block").addClass("connectquiz_display_block_done"),a.ajax({url:window.wwwroot+"/mod/connectquiz/ajax/connectquiz_callback.php",dataType:"html",data:{acurl:d,sco:e,courseid:f,options:encodeURIComponent(c.data("options")),frommymeetings:c.data("frommymeetings"),frommyrecordings:c.data("frommyrecordings")}}).done(function(a){c.html(a)}).fail(function(a,b,d){i(c,"danger",a.status+" "+a.statusText)})})}function k(a,b,c){var d='<div class="fitem" id="fgroup_id_urlgrp_alert">';d+='<div class="felement fstatic alert alert-'+b+' alert-dismissible">',d+='<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>',d+=c,d+="</div>",d+="</div>",a.html(d)}function l(){a(".connectslide_display_block").each(function(b){var c=a(this),d=c.data("acurl"),e=c.data("sco"),f=c.data("courseid");c.removeClass("connectslide_display_block").addClass("connectslide_display_block_done"),a.ajax({url:window.wwwroot+"/mod/connectslide/ajax/connectslide_callback.php",dataType:"html",data:{acurl:d,sco:e,courseid:f,options:encodeURIComponent(c.data("options")),frommymeetings:c.data("frommymeetings"),frommyrecordings:c.data("frommyrecordings")}}).done(function(a){c.html(a)}).fail(function(a,b,d){k(c,"danger",a.status+" "+a.statusText)})})}function m(){a(".rtrecording_display_block").each(function(b){var c=a(this),d=c.data("acurl"),e=c.data("courseid"),f=c.data("rtrecording_id");c.removeClass("rtrecording_display_block").addClass("rtrecording_display_block_done"),a.ajax({url:window.wwwroot+"/mod/rtrecording/ajax/rtrecording_callback.php",dataType:"html",data:{acurl:d,courseid:e,rtrecording_id:f,options:encodeURIComponent(c.data("options"))}}).done(function(a){c.html(a)}).fail(function(a,b,d){n(c,"danger",a.status+" "+a.statusText)})})}function n(a,b,c){var d='<div class="fitem" id="fgroup_id_urlgrp_alert">';d+='<div class="felement fstatic alert alert-'+b+' alert-dismissible">',d+='<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>',d+=c,d+="</div>",d+="</div>",a.html(d)}function o(b){a("input[name='typeisvideo']").val()||(a("#id_ajax_spin").remove(),a("#id_browse").after(' <span id="id_ajax_spin" class="rt-loading-image"></span>'),a.post(window.wwwroot+"/mod/rtrecording/ajax/ajax.php",{action:"connect_get_sco_by_url",url:b},function(c){if(c.refined_noauth)a("#id_url").val(""),a("#id_name").val(""),d("danger",c.refined_noauth_message);else if(c.error)d("danger",c.error);else if("connect_not_update"==c.response){if("undefined"!=typeof M.str.connect.connect_not_update){var e=M.str.connect.typelistmeeting+M.str.connect.connect_not_update;d("danger",e)}}else if("no-data"==c.response||c.response.fixedurl){if(c.response.fixedurl&&(b=c.response.fixedurl),a("#id_url").val(b),"undefined"!=typeof M.str.connect.whensaved){var e=M.str.connect.notfound+M.str.connect.typelistmeeting+M.str.connect.whensaved;d("success",e)}else if("undefined"!=typeof M.str.connect.connect_not_update){var e=M.str.connect.notfound+M.str.connect.typelistmeeting+M.str.connect.connect_not_update;d("danger",e)}a("#id_name").removeClass("do-not-check")}else"archive"!=c.response.icon?(a("#id_url").val(""),a("#id_name").val(""),d("danger","Provided Url must be for a recording")):c.response.name?(a("#id_url").val(c.response.url.replace(/\//g,"")),a("#id_name").val(c.response.name).addClass("do-not-check"),"undefined"!=typeof tinymce?tinymce.get("id_introeditor").setContent(c.response.desc):a("#id_introeditoreditable").html(c.response.desc)):"denied"==c.response?(a("#id_url").val(""),d("danger","Access Denied, you do not have access to this url")):d("danger",c);p(b)}).done(function(){a("#id_ajax_spin").remove()}))}function p(b){a.post(window.wwwroot+"/mod/rtrecording/ajax/ajax.php",{action:"connect_check_if_vp_recording",url:b},function(b){b.response?a("#id_detailgrading").attr("disabled",!1):(a("#id_detailgrading").val(0),a("#id_detailgrading").attr("disabled",!0),a("#id_threshold_1").parent().parent().parent().parent().hide(),a("#id_threshold_2").parent().parent().parent().parent().hide(),a("#id_threshold_3").parent().parent().parent().parent().hide(),a("#id_vpthreshold_1").parent().parent().parent().parent().hide(),a("#id_vpthreshold_2").parent().parent().parent().parent().hide(),a("#id_vpthreshold_3").parent().parent().parent().parent().hide())})}function q(){a("#id_start_enabled").is(":checked")?a("#id_remhdr").show():a("#id_remhdr").hide()}function r(){a("#id_start_enabled").is(":checked")?(a("#id_detailgrading").val(0),a("#id_detailgrading option[value=1]").hide()):a("#id_detailgrading option[value=1]").show()}a(document).ready(function(){!function(a,b){var c;return c=function(){function b(b,c,d){var e,f;e=a(b),f={root:"/",script:"/files/filetree",folderEvent:"click",expandSpeed:500,collapseSpeed:500,expandEasing:"swing",collapseEasing:"swing",multiFolder:!0,loadMessage:"Loading...",errorMessage:"Unable to get file tree information",multiSelect:!1,onlyFolders:!1,onlyFiles:!1},this.jqft={container:e},this.options=a.extend(f,c),this.callback=d,e.html('<ul class="jqueryFileTree start"><li class="wait">'+this.options.loadMessage+"<li></ul>"),this.showTree(e,escape(this.options.root))}return b.prototype.showTree=function(b,c){var d,e,f,g;return d=a(b),g=this.options,e=this,d.addClass("wait"),a(".jqueryFileTree.start").remove(),f={dir:c,onlyFolders:g.onlyFolders,onlyFiles:g.onlyFiles,multiSelect:g.multiSelect},a.ajax({url:g.script,type:"POST",dataType:"HTML",data:f}).done(function(b){var f;return d.find(".start").html(""),d.removeClass("wait").append(b),g.root===c?d.find("UL:hidden").show("undefined"!=typeof callback&&null!==callback):(void 0===jQuery.easing[g.expandEasing]&&(console.log("Easing library not loaded. Include jQueryUI or 3rd party lib."),g.expandEasing="swing"),d.find("UL:hidden").slideDown({duration:g.expandSpeed,easing:g.expandEasing})),f=a('[rel="'+decodeURIComponent(c)+'"]').parent(),g.multiSelect&&f.children("input").is(":checked")&&f.find("ul li input").each(function(){return a(this).prop("checked",!0),a(this).parent().addClass("selected")}),e.bindTree(d)}).fail(function(){return d.find(".start").html(""),d.removeClass("wait").append("<p>"+g.errorMessage+"</p>"),!1})},b.prototype.bindTree=function(b){var c,d,e,f,g,h;return c=a(b),g=this.options,f=this.jqft,d=this,e=this.callback,h=/^\/.*\/$/i,c.find("LI A").on(g.folderEvent,function(){var b,c;return b={},b.li=a(this).closest("li"),b.type=null!=(c=b.li.hasClass("directory"))?c:{directory:"file"},b.value=a(this).text(),b.rel=a(this).prop("rel"),b.container=f.container,a(this).parent().hasClass("directory")?a(this).parent().hasClass("collapsed")?(d._trigger(a(this),"filetreeexpand",b),g.multiFolder||(a(this).parent().parent().find("UL").slideUp({duration:g.collapseSpeed,easing:g.collapseEasing}),a(this).parent().parent().find("LI.directory").removeClass("expanded").addClass("collapsed")),a(this).parent().removeClass("collapsed").addClass("expanded"),a(this).parent().find("UL").remove(),d.showTree(a(this).parent(),a(this).attr("rel").match(h)[0]),d._trigger(a(this),"filetreeexpanded",b)):(d._trigger(a(this),"filetreecollapse",b),a(this).parent().find("UL").slideUp({duration:g.collapseSpeed,easing:g.collapseEasing}),a(this).parent().removeClass("expanded").addClass("collapsed"),d._trigger(a(this),"filetreecollapsed",b)):(g.multiSelect?a(this).parent().find("input").is(":checked")?(a(this).parent().find("input").prop("checked",!1),a(this).parent().removeClass("selected")):(a(this).parent().find("input").prop("checked",!0),a(this).parent().addClass("selected")):(f.container.find("li").removeClass("selected"),a(this).parent().addClass("selected")),d._trigger(a(this),"filetreeclicked",b),"function"==typeof e&&e(a(this).attr("rel"))),!1}),"click"!==g.folderEvent.toLowerCase?c.find("LI A").on("click",function(){return!1}):void 0},b.prototype._trigger=function(b,c,d){var e;return e=a(b),e.trigger(c,d)},b}(),a.fn.extend({fileTree:function(b,d){return this.each(function(){var e,f;return e=a(this),f=e.data("fileTree"),f||e.data("fileTree",f=new c(this,b,d)),"string"==typeof b?f[option].apply(f):void 0})}})}(a,window),h(),j(),l(),m(),a("#id_generate").click(function(){var a=Math.random().toString(36).slice(2,8);a=a.replace(/^[0-9]/,"a"),b(a)}),a("#id_url").keyup(function(){var c=a(this).val();d(function(){"undefined"!=typeof a("#id_browse").data("rtrecording")?o(c):b(c)},1e3)}),a("#id_url").blur(function(){var c=a(this).val();"undefined"!=typeof a("#id_browse").data("rtrecording")?o(c):b(c)}),a("#id_name").keyup(function(){if(!a(this).hasClass("do-not-check")){var b=a(this).val();d(function(){c(b)},3e3)}}),a("#id_name").blur(function(){if(!a(this).hasClass("do-not-check")){var b=a(this).val();c(b)}}),a("#id_browse").click(function(){var c=a("<div id='browseurl_window'></div>");c.fileTree({script:window.wwwroot+"/local/connect/ajax/jqueryFileTree.php",expandSpeed:1e3,collapseSpeed:1e3,multiFolder:!1},function(c){a("#browseurl_window").dialog("destroy"),a("#id_url").val(c),"undefined"!=typeof a("#id_browse").data("rtrecording")?o(c):b(c)}).dialog({title:window.browsetitle,modal:!0,width:"80%",minHeight:450,height:450,resizable:!1}).dialog("open")});var d=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}();"undefined"!=typeof a("#id_browse").data("rtrecording")&&q(),"undefined"!=typeof a("#id_browse").data("rtrecording")&&(r(),a("#id_start_enabled").change(function(){q(),r()})),f(),a("#id_detailgrading").change(function(){f()}),"undefined"!=typeof a("#id_browse").data("rtrecording")&&(connectUrl=a("#id_url").val(),connectUrl&&p(connectUrl)),a("body").on("click","#connectmeeting-update-from-adobe",function(b){b.preventDefault();var c=a(this),d=c.data("connectmeetingid");a("#connectmeetingcontent"+d).html(""),a("#connectmeetingcontent"+d).addClass("rt-loading-image"),a.ajax({url:window.wwwroot+"/mod/connectmeeting/ajax/connectmeeting_callback.php",dataType:"html",data:{connectmeeting_id:d,update_from_adobe:1}}).done(function(b){a("#connectmeetingcontent"+d).removeClass("rt-loading-image"),a("#connectmeetingcontent"+d).html(b)})}),a("body").on("click","#connectquiz-update-from-adobe",function(b){b.preventDefault();var c=a(this),d=c.data("connectquizid");a("#connectquizcontent"+d).html(""),a("#connectquizcontent"+d).addClass("rt-loading-image"),a.ajax({url:window.wwwroot+"/mod/connectquiz/ajax/connectquiz_callback.php",dataType:"html",data:{connectquiz_id:d,update_from_adobe:1}}).done(function(b){a("#connectquizcontent"+d).removeClass("rt-loading-image"),a("#connectquizcontent"+d).html(b)})}),a("body").on("click","#connectslide-update-from-adobe",function(b){b.preventDefault();var c=a(this),d=c.data("connectslideid");a("#connectslidecontent"+d).html(""),a("#connectslidecontent"+d).addClass("rt-loading-image"),a.ajax({url:window.wwwroot+"/mod/connectslide/ajax/connectslide_callback.php",dataType:"html",data:{connectslide_id:d,update_from_adobe:1}}).done(function(b){a("#connectslidecontent"+d).removeClass("rt-loading-image"),a("#connectslidecontent"+d).html(b)})}),a("body").on("click","#rtrecording-update-from-adobe",function(b){b.preventDefault();var c=a(this),d=c.data("rtrecordingid");a("#recordingcontent"+d).html(""),a("#recordingcontent"+d).addClass("rt-loading-image"),a.ajax({url:window.wwwroot+"/mod/rtrecording/ajax/rtrecording_callback.php",dataType:"html",data:{rtrecording_id:d,update_from_adobe:1}}).done(function(b){a("#recordingcontent"+d).removeClass("rt-loading-image"),a("#recordingcontent"+d).html(b)})})})}}});